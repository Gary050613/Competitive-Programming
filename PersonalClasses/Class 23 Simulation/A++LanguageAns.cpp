#include<iostream>
#include<stack>
#include<cstring>
#include<algorithm>
#include<cstdio>
/*
t ????? 
  ?? l ? 
  
????,????????,?????? 
*/
using namespace std;
const int maxl = 105;
int t,l,w;
string o;
string code[maxl];
//???? 
//??????? c ???? x ??????,??? F x 1 n ?? n ??????,???????? 
int sread(int &x,string c){
	int res = 0;
	int len = c.size();
	while(c[x] <'0' || c[x] > '9' && x < c.size()){
		if(c[x] == 'n'){
			//??,?? ++x 
			++x;
			return 1000000;
		}
		++x;
	}
	while(c[x] >= '0' && c[x] <= '9'){
		res *= 10;
		res += c[x] -'0';
		++x;
	}
	return res;
}
//?????
//???? n ,?????? n^0,
//???,??n^w,??????? w ?????? 
int geto(){
	// x = 3:??? 3 ???,O(1) ?? O(n^w) 
	int res = 0, x = 3;
	int len = o.size();
	if(o[2] == 'n'){
		//??? O(n^w),??w,?? w ? 0 
		res = sread(x,o);
	}
	else{
		res = 0;
	}
	return res;
}
//??????
//????? -1,???????,???????????(now ??) 
int check(){
	int res = 0,now = 0;
	int a,b,x;
	//???????? 
	stack<int> s;
	//???? F ,??????,? k ??,?? F x i j  ?? i j,??? a b ???
	//? k ??
	//?? b < a ,???????,??? flag ?????????? k,??????,? flag = -1
	//?? a <= b, ?????,? b-a > 1000,?? flag = -1,????????????,?? now++
	//			   ??? ef[26] ?? now++?? k ?? ,???? k ?????????,???? now--,ef[k] = false 
	int flag = -1;
	bool ins[26] = {0};
	bool ef[26] = {0};
	for(int i = 1; i <= l; i++){
		if(code[i][0] == 'F'){
			int k = code[i][2] - 'a';
			if(ins[k]) return -1;
			s.push(k);
			ins[k] = true;
			x = 4;
			a = sread(x,code[i]);
			b = sread(x,code[i]);
			if(b-a > 1000){
				if(flag == -1){
					now++;
					res = max(res,now);
					ef[k] = true;
				}
			}
			if(a>b){
				if(flag == -1){
					flag = k;
				}
			}
		}
		if(code[i][0] == 'E'){
			if(s.empty()){
				return -1;
			}
			int k = s.top();
			s.pop();
			ins[k] = false;
			if(ef[k]){
				ef[k] = false;
				now--;
			}
		}
	}
	if(s.size()){
		return -1;
	}
	return res;
}
/*
	F ? E ???
		1. F ? E ? :k??????????? ?,?????????,return -1 
		2. F ? E ? :??????? ??????,?????,??????,return -1 

	bool ins[26] ???????????,??????????
	?? k ???,?? k ????????, k ?????,??????????,return -1
	?? k ???,???????,????,??????,return -1
*/ 
int main(){
	//?? t 
	scanf("%d",&t);
	while(t--){
		int ww;
		//???? %d ?????,??? l ??????? 
		scanf("%d ",&l);
		//getline(cin,0) ??????? 
		getline(cin,o);
		w = geto();
		for(int i = 1; i <= l; i++){
			getline(cin,code[i]);
		}
		ww = check();
		if(ww == -1){
			puts("ERR"); 
		}
		else{
			if(ww == w){
				puts("Yes");
			}
			else{
				puts("No");
			}
		}
	}

	return 0;
}

/*
8
2 O(1)
F i 1 1
E
2 O(n^1)
F x 1 n
E
1 O(1)
F x 1 n
4 O(n^2)
F x 5 n
F y 10 n
E
E
4 O(n^2)
F x 9 n
E
F y 2 n
E
4 O(n^1)
F x 9 n
F y n 4
E
E
4 O(1)
F y n 4
F x 9 n
E
E
4 O(n^2)
F x 1 n
F x 1 10
E
E
*/ 
